{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/objectSpread\");\nvar _classCallCheck = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\nvar _createClass = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\nvar _possibleConstructorReturn = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/possibleConstructorReturn\");\nvar _get = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/get\");\nvar _getPrototypeOf = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/getPrototypeOf\");\nvar _inherits = require(\"F:\\\\programnodejs\\\\project\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeDeleteStatement = exports.DeleteManyOperation = exports.DeleteOneOperation = exports.DeleteOperation = void 0;\nvar error_1 = require(\"../error\");\nvar utils_1 = require(\"../utils\");\nvar command_1 = require(\"./command\");\nvar operation_1 = require(\"./operation\");\n/** @internal */\nvar DeleteOperation = /*#__PURE__*/function (_command_1$CommandOpe) {\n  _inherits(DeleteOperation, _command_1$CommandOpe);\n  function DeleteOperation(ns, statements, options) {\n    var _this;\n    _classCallCheck(this, DeleteOperation);\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DeleteOperation).call(this, undefined, options));\n    _this.options = options;\n    _this.ns = ns;\n    _this.statements = statements;\n    return _this;\n  }\n  _createClass(DeleteOperation, [{\n    key: \"execute\",\n    value: function execute(server, session, callback) {\n      var _a;\n      var options = (_a = this.options) !== null && _a !== void 0 ? _a : {};\n      var ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n      var command = {\n        delete: this.ns.collection,\n        deletes: this.statements,\n        ordered: ordered\n      };\n      if (options.let) {\n        command.let = options.let;\n      }\n      // we check for undefined specifically here to allow falsy values\n      // eslint-disable-next-line no-restricted-syntax\n      if (options.comment !== undefined) {\n        command.comment = options.comment;\n      }\n      if (options.explain != null && (0, utils_1.maxWireVersion)(server) < 3) {\n        return callback ? callback(new error_1.MongoCompatibilityError(\"Server \".concat(server.name, \" does not support explain on delete\"))) : undefined;\n      }\n      var unacknowledgedWrite = this.writeConcern && this.writeConcern.w === 0;\n      if (unacknowledgedWrite || (0, utils_1.maxWireVersion)(server) < 5) {\n        if (this.statements.find(function (o) {\n          return o.hint;\n        })) {\n          callback(new error_1.MongoCompatibilityError(\"Servers < 3.4 do not support hint on delete\"));\n          return;\n        }\n      }\n      var statementWithCollation = this.statements.find(function (statement) {\n        return !!statement.collation;\n      });\n      if (statementWithCollation && (0, utils_1.collationNotSupported)(server, statementWithCollation)) {\n        callback(new error_1.MongoCompatibilityError(\"Server \".concat(server.name, \" does not support collation\")));\n        return;\n      }\n      _get(_getPrototypeOf(DeleteOperation.prototype), \"executeCommand\", this).call(this, server, session, command, callback);\n    }\n  }, {\n    key: \"canRetryWrite\",\n    get: function get() {\n      if (_get(_getPrototypeOf(DeleteOperation.prototype), \"canRetryWrite\", this) === false) {\n        return false;\n      }\n      return this.statements.every(function (op) {\n        return op.limit != null ? op.limit > 0 : true;\n      });\n    }\n  }]);\n  return DeleteOperation;\n}(command_1.CommandOperation);\nexports.DeleteOperation = DeleteOperation;\nvar DeleteOneOperation = /*#__PURE__*/function (_DeleteOperation) {\n  _inherits(DeleteOneOperation, _DeleteOperation);\n  function DeleteOneOperation(collection, filter, options) {\n    _classCallCheck(this, DeleteOneOperation);\n    return _possibleConstructorReturn(this, _getPrototypeOf(DeleteOneOperation).call(this, collection.s.namespace, [makeDeleteStatement(filter, _objectSpread({}, options, {\n      limit: 1\n    }))], options));\n  }\n  _createClass(DeleteOneOperation, [{\n    key: \"execute\",\n    value: function execute(server, session, callback) {\n      var _this2 = this;\n      _get(_getPrototypeOf(DeleteOneOperation.prototype), \"execute\", this).call(this, server, session, function (err, res) {\n        var _a, _b;\n        if (err || res == null) return callback(err);\n        if (res.code) return callback(new error_1.MongoServerError(res));\n        if (res.writeErrors) return callback(new error_1.MongoServerError(res.writeErrors[0]));\n        if (_this2.explain) return callback(undefined, res);\n        callback(undefined, {\n          acknowledged: (_b = ((_a = _this2.writeConcern) === null || _a === void 0 ? void 0 : _a.w) !== 0) !== null && _b !== void 0 ? _b : true,\n          deletedCount: res.n\n        });\n      });\n    }\n  }]);\n  return DeleteOneOperation;\n}(DeleteOperation);\nexports.DeleteOneOperation = DeleteOneOperation;\nvar DeleteManyOperation = /*#__PURE__*/function (_DeleteOperation2) {\n  _inherits(DeleteManyOperation, _DeleteOperation2);\n  function DeleteManyOperation(collection, filter, options) {\n    _classCallCheck(this, DeleteManyOperation);\n    return _possibleConstructorReturn(this, _getPrototypeOf(DeleteManyOperation).call(this, collection.s.namespace, [makeDeleteStatement(filter, options)], options));\n  }\n  _createClass(DeleteManyOperation, [{\n    key: \"execute\",\n    value: function execute(server, session, callback) {\n      var _this3 = this;\n      _get(_getPrototypeOf(DeleteManyOperation.prototype), \"execute\", this).call(this, server, session, function (err, res) {\n        var _a, _b;\n        if (err || res == null) return callback(err);\n        if (res.code) return callback(new error_1.MongoServerError(res));\n        if (res.writeErrors) return callback(new error_1.MongoServerError(res.writeErrors[0]));\n        if (_this3.explain) return callback(undefined, res);\n        callback(undefined, {\n          acknowledged: (_b = ((_a = _this3.writeConcern) === null || _a === void 0 ? void 0 : _a.w) !== 0) !== null && _b !== void 0 ? _b : true,\n          deletedCount: res.n\n        });\n      });\n    }\n  }]);\n  return DeleteManyOperation;\n}(DeleteOperation);\nexports.DeleteManyOperation = DeleteManyOperation;\nfunction makeDeleteStatement(filter, options) {\n  var op = {\n    q: filter,\n    limit: typeof options.limit === 'number' ? options.limit : 0\n  };\n  if (options.single === true) {\n    op.limit = 1;\n  }\n  if (options.collation) {\n    op.collation = options.collation;\n  }\n  if (options.hint) {\n    op.hint = options.hint;\n  }\n  return op;\n}\nexports.makeDeleteStatement = makeDeleteStatement;\n(0, operation_1.defineAspects)(DeleteOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION]);\n(0, operation_1.defineAspects)(DeleteOneOperation, [operation_1.Aspect.RETRYABLE, operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.EXPLAINABLE, operation_1.Aspect.SKIP_COLLATION]);\n(0, operation_1.defineAspects)(DeleteManyOperation, [operation_1.Aspect.WRITE_OPERATION, operation_1.Aspect.EXPLAINABLE, operation_1.Aspect.SKIP_COLLATION]);","map":null,"metadata":{},"sourceType":"script"}